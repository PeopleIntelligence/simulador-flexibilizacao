<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>SSO - Simulador de Flexibiliza√ß√£o</title>

  <!-- Carrega MSAL.js CORRETAMENTE (com src e via HTTPS) -->
  https://alcdn.msauth.net/browser/2.32.0/js/msal-browser.min.js</script>

  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .hidden { display: none; }
    button { padding: 10px 14px; background: #0078D4; color: #fff; border: 0; border-radius: 4px; cursor: pointer; }
    button:hover { background: #005A9E; }
    .card { max-width: 560px; padding: 16px; border: 1px solid #e5e5e5; border-radius: 8px; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 8px; margin-top: 6px; }
  </style>
</head>
<body>
  <h1>Simulador de Descontos de Flexibiliza√ß√£o</h1>

  <!-- Acesso -->
  <div class="card" id="areaLogin">
    <p>Para acessar o simulador, √© necess√°rio autenticar-se com sua conta corporativa.</p>
    <button id="btnEntrar" type="button">Entrar</button>
    <p id="msg" style="color:#cc0000; margin-top:10px;"></p>
  </div>

  <!-- Simulador (liberado ap√≥s login) -->
  <div class="card hidden" id="areaSimulador">
    <h2>C√°lculo de Descontos</h2>
    <p style="background:#fff6d9; padding:8px; border-radius:6px">
      ‚ö†Ô∏è Aten√ß√£o: Os valores calculados s√£o estimativas e t√™m apenas car√°ter orientativo. 
      A empresa remunera 50% das horas n√£o trabalhadas.
    </p>

    <label for="salario">Sal√°rio bruto mensal (R$)</label>
    <input type="number" id="salario" placeholder="Ex.: 4500" min="0" step="0.01" />

    <label for="dias">Quantidade de dias de flexibiliza√ß√£o</label>
    <input type="number" id="dias" placeholder="Ex.: 3" min="0" step="1" />

    <button id="btnCalcular" type="button" style="margin-top:12px;">Calcular Simula√ß√£o</button>

    <div id="resultado" style="margin-top:16px;"></div>

    <p style="font-size:12px;color:#555;margin-top:12px">
      üßÆ M√©todo:<br>
      ‚Ä¢ Valor di√°rio = Sal√°rio √∑ 30<br>
      ‚Ä¢ Desconto = (Valor di√°rio √ó Dias flexibilizados) √∑ 2<br>
      ‚Ä¢ Custo empresa = ((Sal√°rio √∑ 220) √ó 1,36 √ó 8,8 √ó 0,5) √ó Dias flexibilizados
    </p>
  </div>

  <!-- Seu c√≥digo da app -->
  <script>
    // ======== CONFIGURA√á√ÉO MSAL (AJUSTE redirectUri) ========
    // Use a URL EXATA do seu GitHub Pages.
    // Pelo que vimos no seu contexto, prov√°vel: https://peopleintelligence.github.io/flexibilizacao-simulador/
    // Se seu reposit√≥rio/usu√°rio for outro, ajuste abaixo E cadastre igual no Azure AD (Redirect URI).
    const msalConfig = {
      auth: {
        clientId: "0c2709b6-cbe4-4e55-9967-f9619abddc54",
        authority: "https://login.microsoftonline.com/812a6bd0-5829-4196-b2be-d0580b7bd0cb",
        redirectUri: "https://peopleintelligence.github.io/flexibilizacao-simulador/",
        postLogoutRedirectUri: "https://peopleintelligence.github.io/flexibilizacao-simulador/"
      },
      cache: {
        cacheLocation: "localStorage", // ajuda em SPA simples
        storeAuthStateInCookie: false
      }
    };

    const loginRequest = { scopes: ["User.Read"] };
    const msalInstance = new msal.PublicClientApplication(msalConfig);

    const $ = (id) => document.getElementById(id);
    const msg = (t) => { $("msg").textContent = t || ""; };

    // Exibe √°reas
    function showSimulador() {
      $("areaLogin").classList.add("hidden");
      $("areaSimulador").classList.remove("hidden");
    }

    // ======== L√ìGICA DE LOGIN ========
    async function loginHandler() {
      msg(""); // limpa mensagens
      try {
        // Popup precisa ser chamado diretamente no clique do usu√°rio (ok, estamos num click handler)
        const response = await msalInstance.loginPopup(loginRequest);

        // Conta logada ‚Äî libera simulador
        console.log("Login OK:", response?.account?.username);
        showSimulador();
      } catch (e) {
        console.error("Erro login:", e);
        msg(`Erro na autentica√ß√£o: ${e?.message || e}`);
      }
    }

    // EXP√ïE A FUN√á√ÉO NO ESCOPO GLOBAL PARA FUNCIONAR COM onclick (se mantiver no HTML)
    window.login = loginHandler;

    // Alternativa melhor: amarre o clique via JS (n√£o depende de onclick no HTML)
    window.addEventListener("DOMContentLoaded", () => {
      $("btnEntrar").addEventListener("click", loginHandler);

      // Tenta restaurar sess√£o (se j√° logou antes no mesmo navegador)
      msalInstance.handleRedirectPromise().then((res) => {
        const accounts = msalInstance.getAllAccounts();
        if (accounts && accounts.length > 0) {
          showSimulador();
        }
      }).catch((e) => {
        console.warn("handleRedirectPromise:", e);
      });

      $("btnCalcular").addEventListener("click", () => {
        const salario = parseFloat($("salario").value);
        const dias = parseInt($("dias").value, 10);
        if (isNaN(salario) || isNaN(dias)) {
          $("resultado").innerHTML = `<span style="color:#cc0000">Preencha os campos corretamente.</span>`;
          return;
        }
        const valorDiario = salario / 30;
        const desconto = (valorDiario * dias) / 2;
        const custoEmpresa = (((salario / 220) * 1.36 * 8.8 * 0.5) * dias);
        const percentual = (desconto / salario) * 100;
        const salarioEstimado = salario - desconto;

        $("resultado").innerHTML = `
          <div>
            <div><strong>Custo para empresa (com encargos):</strong> R$ ${custoEmpresa.toFixed(2)}</div>
            <div><strong>Desconto do funcion√°rio:</strong> R$ ${desconto.toFixed(2)}</div>
            <div><strong>Percentual do sal√°rio:</strong> ${percentual.toFixed(2)}%</div>
            <div><strong>Sal√°rio estimado*:</strong> R$ ${salarioEstimado.toFixed(2)}</div>
            <div style="font-size:12px;color:#555;margin-top:6px">*N√£o considera encargos, benef√≠cios, extras etc.</div>
          </div>
        `;
      });
    });
  </script>
</body>
</html>
